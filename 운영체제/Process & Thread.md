# 프로세스와 쓰레드



## 프로세스

프로세스는 실행 중인 프로그램, 디스크로부터 메모리에 적재되어 CPU의 할당을 받을 수 있는 것을 말함. 

일반적으로 CPU에 의해 처리되는 사용자 프로그램, 

OS로부터 주소 공간, 파일, 메모리를 할당 받는 것. 구체적으로 살펴보면 프로세스는 함수의 매개변수, 복귀 주소와 로컬 변수와 같은 임시 자료를 갖는 프로세스 스택과 전역 변수들을 수록하는 데이터 섹션을 포함. 프로세스는 프로세스 실행 중 동적으로 할당되는 메모리인 힙을 포함한다.



### 프로세스 제어 블록 (PCB)

PCB는 특정 프로세스에 대한 정보를 저장하고 잇는 운영체제의 자료구조.

프로세스의 생성과 동시에 고유한 피시비를 생성한다. 프로세스는 CPU를 할당받아 작업을 처리하다가도 프로세스 전환이 발생하면 진행하던 작업을 저장하고 CPU를 반환해야하는데 이때 정보들을 모두 PCB에 저장하게 된다.



저장되는 정보 

프로세스 식별자, 프로세스 상태, 프로세스 카운터, CPU 레지스터, 스케쥴링 정보, 메모리 관리ㅏ 정보, 입출력 상태 정보, 어카운팅 정보





## 스레드

스레드의 프로세스 실행 단위, 한 프로세스 내 동작되는 여러 실행 흐름으로 프로세스 내의 주소 공간이나 자원을 공유할 수 잇다.

스레드는 스레드 ID, 프로그램 카운터, 레지스터 집합, 스택으로 구성된다. 같은 프로세스에 속한 다른 스레드와 코드, 데이터 섹션, 그리고 열린 파일이나 신호와 같은 운영체제 자원을 공유한다. 하나의 프로세스를 다수으이 실행단위로 구분하여 자원을 공유하고 자원의 생성과 관리의 중복성을 최소화 하여 수행 능력을 향상시키는 것을 멀티스레딩이라고 한다. 이 경우 각각의 스레드는 독립적인 작업을 수행해야 하기 때문에 각자의 스택과 PC 레지스터 값을 가지고 있다.



### 멀티스레드

프로세스를 이용해 동시에 처리하던 일을 스레드로 구현할 경우 메모리 공간과 시스템 자우너 소모가 줄어들게 된다. 스레드 간의 통신이 필요한 경우에도 별도의 자원을 이용하는 것이 아니라 전역 변수의 공간 또는 동적으로 할당된 공간인 Heap 영역을 이용하여 데이터를 주고 받을 수 있다. 그래서 프로세스 간 통신 방법에 비해 스레드 간의 통신 방법이 훨씬 간단하다. 심지어 스레드의 컨텍스트 스위치는 프로세스 컨텍스트 스위치와 달리 캐시 메모리를 비울 필요가 없어 더 빠르다. 



#### 멀티스레드의 문제점

멀티 프로세스 기반으로 프로그래밍할 때는 프로세스 간 공유하는 자원이 없기 때문에 동일 자원에 동시에 접근하는 일이 없지만 멀티스레딩을 기반으로 프로그래밍할 때는 동일한 자원에 동시에 접근하기 때문에 이미 다른 스레드에서 사용 중인 변수나 자료구조에 접근해 엉뚱한 값을 읽어오거나 수정할 수 있다. 

그래서 멀티스레딩 환경에서 동기화 작업이 필요하다. 이로 인해 병목현상이 발생해 성능이 저하될 수 있다. 과도한 락으로 인한 병목현상을 줄여야한다.



### 멀티스레드 VS 멀티 프로세스

멀티 스레드는 멀티 프로세스보다 적은 메모리를 차지하고 문맥 전환이 빠르다. 오류로 인해 하나의 스레드가 종료되면 전체 스레드가 종료될 수 있다는 점과 동기화 문제를 안고 있다. 통신 비용이 적게든다.

멀티 프로세스는 하나의 프로세스가 죽어도 다른 프로세스에 영향을 끼치지 않고 수행된다는 장점이 있지만 메모리와 CPU 시간을 차지한다는 단점이 있다.

두 가지 모두 동시에 여러 작업을 수행한다는 점에서 같지만 적용해야 하는 시스템에 따라 적합/부적합이 구분된다. 따라서 대상 시스템의 특징에 따라 적합한 동작 방식을 선택하고 적용해야한다.